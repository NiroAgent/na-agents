<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NA-Agents Chat Interface</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 0;
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(90deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 300;
        }

        .agent-status {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            flex-wrap: wrap;
        }

        .agent {
            display: flex;
            align-items: center;
            margin: 5px;
            font-size: 12px;
        }

        .agent-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
            background: #dc3545;
        }

        .agent-dot.online {
            background: #28a745;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            animation: fadeIn 0.3s ease-in;
        }

        .message.user {
            text-align: right;
        }

        .message-bubble {
            display: inline-block;
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
        }

        .message.user .message-bubble {
            background: #007bff;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.agent .message-bubble {
            background: white;
            color: #333;
            border: 1px solid #dee2e6;
            border-bottom-left-radius: 4px;
        }

        .message-info {
            font-size: 11px;
            margin-top: 4px;
            opacity: 0.7;
        }

        .input-area {
            display: flex;
            padding: 20px;
            background: white;
            border-top: 1px solid #dee2e6;
            align-items: center;
        }

        #messageInput {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ced4da;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            margin-right: 10px;
        }

        #messageInput:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        #sendButton {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        #sendButton:hover {
            background: #0056b3;
        }

        #sendButton:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            padding: 10px 20px;
            background: #e9ecef;
            border-radius: 15px;
            margin: 10px 0;
            font-style: italic;
        }

        .typing-dots {
            display: inline-block;
        }

        .typing-dots::after {
            content: '...';
            animation: typing 1.5s infinite;
        }

        @keyframes typing {
            0%, 60%, 100% { opacity: 0; }
            30% { opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .connection-status.connected {
            background: #d4edda;
            color: #155724;
        }

        .connection-status.disconnected {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">Connecting...</div>
    
    <div class="chat-container">
        <div class="header">
            <h1>ðŸ¤– NA-Agents Multi-Agent Chat</h1>
            <p>Intelligent assistance from AI Architect, Developer, DevOps, QA, and Manager agents</p>
        </div>
        
        <div class="agent-status">
            <div class="agent">
                <div class="agent-dot" id="architectStatus"></div>
                Architect
            </div>
            <div class="agent">
                <div class="agent-dot" id="developerStatus"></div>
                Developer
            </div>
            <div class="agent">
                <div class="agent-dot" id="devopsStatus"></div>
                DevOps
            </div>
            <div class="agent">
                <div class="agent-dot" id="qaStatus"></div>
                QA
            </div>
            <div class="agent">
                <div class="agent-dot" id="managerStatus"></div>
                Manager
            </div>
        </div>
        
        <div class="messages" id="messages">
            <div class="message agent">
                <div class="message-bubble">
                    ðŸ‘‹ Welcome to the NA-Agents system! I'm here to help you with architecture, development, deployment, testing, and project management tasks. 
                    Just type your question or request, and I'll route it to the most appropriate AI agent.
                </div>
                <div class="message-info">System â€¢ Just now</div>
            </div>
        </div>
        
        <div class="typing-indicator" id="typingIndicator">
            <span class="typing-dots">Agent is thinking</span>
        </div>
        
        <div class="input-area">
            <input type="text" id="messageInput" placeholder="Ask any question about architecture, development, deployment, testing, or project management..." />
            <button id="sendButton">Send</button>
        </div>
    </div>

    <script>
        // Initialize Socket.IO connection
        const socket = io();
        
        // DOM elements
        const messagesDiv = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const connectionStatus = document.getElementById('connectionStatus');
        
        // Generate unique session ID
        const sessionId = 'session-' + Math.random().toString(36).substr(2, 9);
        
        // Connection status handling
        socket.on('connect', () => {
            connectionStatus.textContent = 'Connected';
            connectionStatus.className = 'connection-status connected';
            checkAgentStatus();
        });
        
        socket.on('disconnect', () => {
            connectionStatus.textContent = 'Disconnected';
            connectionStatus.className = 'connection-status disconnected';
            updateAllAgentStatus(false);
        });
        
        // Check agent status
        function checkAgentStatus() {
            const agents = ['architect', 'developer', 'devops', 'qa', 'manager'];
            const ports = [5001, 5002, 5003, 5004, 5005];
            
            agents.forEach((agent, index) => {
                fetch(`http://localhost:${ports[index]}/health`)
                    .then(response => response.ok)
                    .then(isOnline => {
                        updateAgentStatus(agent, isOnline);
                    })
                    .catch(() => {
                        updateAgentStatus(agent, false);
                    });
            });
        }
        
        function updateAgentStatus(agentType, isOnline) {
            const statusElement = document.getElementById(agentType + 'Status');
            if (statusElement) {
                statusElement.className = isOnline ? 'agent-dot online' : 'agent-dot';
            }
        }
        
        function updateAllAgentStatus(isOnline) {
            ['architect', 'developer', 'devops', 'qa', 'manager'].forEach(agent => {
                updateAgentStatus(agent, isOnline);
            });
        }
        
        // Message handling
        function addMessage(content, type = 'user', agentType = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            bubbleDiv.textContent = content;
            
            const infoDiv = document.createElement('div');
            infoDiv.className = 'message-info';
            infoDiv.textContent = agentType ? `${agentType} Agent â€¢ ${new Date().toLocaleTimeString()}` : `You â€¢ ${new Date().toLocaleTimeString()}`;
            
            messageDiv.appendChild(bubbleDiv);
            messageDiv.appendChild(infoDiv);
            messagesDiv.appendChild(messageDiv);
            
            // Scroll to bottom
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function showTyping() {
            typingIndicator.style.display = 'block';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function hideTyping() {
            typingIndicator.style.display = 'none';
        }
        
        // Send message
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
            
            addMessage(message, 'user');
            messageInput.value = '';
            sendButton.disabled = true;
            showTyping();
            
            // Emit message to server
            socket.emit('chat_message', {
                sessionId: sessionId,
                message: message,
                timestamp: new Date().toISOString()
            });
        }
        
        // Socket event listeners
        socket.on('agent_response', (data) => {
            hideTyping();
            addMessage(data.response, 'agent', data.agentType);
            sendButton.disabled = false;
            updateAgentStatus(data.agentType, true);
        });
        
        socket.on('agent_error', (data) => {
            hideTyping();
            addMessage('Sorry, I encountered an error processing your request. Please try again.', 'agent', 'System');
            sendButton.disabled = false;
        });
        
        // Event listeners
        sendButton.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Periodically check agent status
        setInterval(checkAgentStatus, 30000); // Check every 30 seconds
    </script>
</body>
</html>